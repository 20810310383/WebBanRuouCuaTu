<!DOCTYPE html>
<html lang="en">
  <head>
    <title>Liquor Store KT- Khắc Tú</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <link rel="shortcut icon" href="images/logo-KTT1.ico" type="image/x-icon">
    
    <link href="https://fonts.googleapis.com/css2?family=Spectral:ital,wght@0,200;0,300;0,400;0,500;0,700;0,800;1,200;1,300;1,400;1,500;1,700&display=swap" rel="stylesheet">

    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">

    <link rel="stylesheet" href="css/animate.css">
    
    <link rel="stylesheet" href="css/owl.carousel.min.css">
    <link rel="stylesheet" href="css/owl.theme.default.min.css">
    <link rel="stylesheet" href="css/magnific-popup.css">

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-select/1.13.1/css/bootstrap-select.min.css">

    <link rel="stylesheet" href="css/flaticon.css">
    <link rel="stylesheet" href="css/style.css">

    <script src="https://code.jquery.com/jquery-3.6.4.min.js" integrity="sha256-oL7JN3KMWF6dy0wKXPsej4lM4PUn3SLDuiZJ+LUEO4A=" crossorigin="anonymous"></script>
    <script src="js/country-states.js"></script>

    <style>
      .nav-item.dropdown .nav-link {
        display: flex;
        justify-content: space-between;
        align-items: center;
      }

      .nav-item.dropdown .dropdown-toggle {
        order: 2; /* Đặt thứ tự xuất hiện cuối cùng */
        margin-left: 5px; /* Thêm khoảng cách giữa chữ và biểu tượng */
      }

    </style>
    <!-- Thêm Thư Viện Flash -->
    <script src="link-to-flash-library.js"></script>
  </head>
  <body>

    <!-- START login header -->
    <%- include('../partials/loginHeader.ejs') %>
    <!-- END login header -->

  	<!-- START nav - header -->
      <nav class="navbar navbar-expand-lg navbar-dark ftco_navbar bg-dark ftco-navbar-light" id="ftco-navbar">
        <div class="container">
              <a class="navbar-brand" href="/home">Liquor <span>store KT</span></a>
  
              <!-- gio hang o day -->
              <%- include('../partials/headerGioHang.ejs') %>
      
              <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#ftco-nav" aria-controls="ftco-nav" aria-expanded="false" aria-label="Toggle navigation">
                <span class="oi oi-menu"></span> Menu
              </button>
      
              <div class="collapse navbar-collapse" id="ftco-nav">
                <ul class="navbar-nav ml-auto">
                  <li class="nav-item "><a href="/home" class="nav-link">Home</a></li>
                  <li class="nav-item" ><a href="about.html" class="nav-link">About</a></li>
                  <li class="nav-item dropdown active">
                    <a class="nav-link dropdown-toggle active" href="#" id="dropdown04" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Sản Phẩm</a>
                    <div class="dropdown-menu" aria-labelledby="dropdown04">				
                        <a class="dropdown-item" href="/search-sp">Sản Phẩm Rượu</a>
                        <!-- <a class="dropdown-item" href="product-single.html">Single Product</a>
                        <a class="dropdown-item" href="cart.html">Cart</a>
                        <a class="dropdown-item" href="checkout.html">Checkout</a> -->
                    </div>
                    </li>
                  <li class="nav-item"><a href="blog.html" class="nav-link">Blog</a></li>
              <li class="nav-item ">
              <a class="nav-link" href="#" id="dropdown05" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                <i  class="fa fa-search" title="Tìm Kiếm"></i>
              </a>
              <div class="dropdown-menu" style="margin-left: 400px;" aria-labelledby="dropdown05">
                
                <%- include('../partials/searchSP.ejs') %>
      
              </div>
                    </li>
      
                </ul>
              </div>
        </div>
      </nav>
      <!-- END nav -->
      <!-- END nav - header -->

    <!-- START slide -->
    <section class="hero-wrap hero-wrap-2" style="background-image: url('images/bg_2.jpg');" data-stellar-background-ratio="0.5">
        <div class="overlay"></div>
        <div class="container">
          <div class="row no-gutters slider-text align-items-end justify-content-center">
            <div class="col-md-9 ftco-animate mb-5 text-center">
                <p class="breadcrumbs mb-0"><span class="mr-2"><a href="/home">Home <i class="fa fa-chevron-right"></i></a></span> <span>Checkout <i class="fa fa-chevron-right"></i></span></p>
              <h2 class="mb-0 bread">Thông tin đặt hàng</h2>
            </div>
          </div>
        </div>
      </section>
    <!-- END slide -->
 <!-- Thêm loader.svg vào trang HTML -->
 <div id="loader" class="loader">
  <img id="loader_page_img" src="css/loader.svg" alt="Loader">
</div>
    <!-- START BODY --  CT CART -->
    <section class="ftco-section">
    	<div class="container">
    		<div class="row justify-content-center">
          <div class="col-xl-10 ftco-animate">
						<form action="/dat-hang" class="billing-form" method="post" id="dathang">
							<h3 class="mb-4 billing-heading">Thông tin đặt hàng</h3>
	          	<div class="row align-items-end">
                    <div class="col-md-7">
                        <div class="form-group">
                            <label for="HoTen">Họ và tên <span style="color: red; font-size: 25px;font-weight: bold;">*</span></label>
                            <input name="HoTen" required id="HoTen" type="text" class="form-control" placeholder="Nhập họ và tên của bạn ..." style=" font-size: 18px;">
                        </div>
                      </div>
	          		<div class="col-md-6">
                        <div class="form-group">
                            <label for="country" class="form-label">Quốc Gia <span style="color: red; font-size: 25px;font-weight: bold;">*</span></label>
                                <div class="select-wrap">
                                    <div class="icon"><span class="ion-ios-arrow-down"></span></div>
                                    <select name="QuocGia" required id="country" class="form-control"  style=" font-size: 18px;">
                                        <option > Chọn Quốc Gia </option>
                                    </select>
                                </div> 
                        </div>
	                </div>
	              <div class="col-md-6">
	                <div class="form-group">
                      <label for="state" class="form-label">Thành Phố <span style="color: red; font-size: 25px;font-weight: bold;">*</span></label>
                                <div class="select-wrap">
                                    <div class="icon"><span class="ion-ios-arrow-down"></span></div>
                                    <select name="ThanhPho" required id="state" class="form-control"  style=" font-size: 18px;">
                                        <option>__</option>
                                    </select>
                                </div> 
	                </div>
                </div>
                <div class="w-100"></div>
		            <div class="w-100"></div>
		            <div class="col-md-12">
		            	<div class="form-group">
                            <label for="DiaChi_ChiTiet">Địa chỉ cụ thể <span style="color: red; font-size: 25px;font-weight: bold;">*</span></label>
                            <input name="DiaChi_ChiTiet" required id="DiaChi_ChiTiet" type="text" class="form-control" placeholder="Vui lòng nhập địa chỉ cụ thể..." style=" font-size: 18px;">
	                    </div>
		            </div>

		            <div class="w-100"></div>
		            <div class="col-md-6">
	                <div class="form-group">
	                	<label for="SDT">Điện thoại <span style="color: red; font-size: 25px;font-weight: bold;">*</span></label>
	                  <input name="SoDienThoai" required id="SDT" type="phone" class="form-control" placeholder="Vui lòng nhập số điện thoại của bạn..." style=" font-size: 18px;">
	                </div>
	              </div>
	              <div class="col-md-6">
	                <div class="form-group">
	                	<label for="Email">Địa chỉ email <span style="color: red; font-size: 25px;font-weight: bold;">*</span></label>
	                  <input required name="Email" id="Email" type="email" class="form-control" placeholder="Vui lòng nhập Địa chỉ email của bạn chính xác..." style=" font-size: 18px;">
	                </div>
                </div>
                <div class="w-100"></div>

	            </div>

	          <div class="row mt-5 pt-3 d-flex">
	          	<div class="col-md-6 d-flex">
	          		<div class="cart-detail cart-total p-3 p-md-4">
	          			<h3 class="billing-heading mb-4">Tổng số giỏ hàng</h3>
                          <p class="d-flex">
                              <span style="color: black;">Số Lượng Đã Đặt</span>
                              <input name="TongSLDat"
                                  type="text" 
                                  readonly 
                                  style="
                                    border: none; /* Loại bỏ viền */
                                    outline: none; /* Loại bỏ đường viền khi được focus */
                                    background-color: transparent; /* Để hiển thị nền trong suốt */
                                    color: blue;
                                    font-size: 18px;
                                    
                                  "
                                  value="<%= cartItemss.totalQuaty !== 0 ? cartItemss.totalQuaty : 0 %>"
                                >
                              <!-- <span style="color: blue; font-size: 18px;"><%= cartItemss.totalQuaty !== 0 ? cartItemss.totalQuaty : 0 %> </span> -->
                          </p>
	          			<p class="d-flex">
                            <span style="color: black;">Tổng Giá 
                                <%= cartItemss.totalQuaty !== 0 ? cartItemss.totalQuaty : 0 %>
                                Sản Phẩm</span>

                                <input 
                                  type="text" 
                                  readonly 
                                  style="
                                    border: none; /* Loại bỏ viền */
                                    outline: none; /* Loại bỏ đường viền khi được focus */
                                    background-color: transparent; /* Để hiển thị nền trong suốt */
                                    color: blue;
                                    font-size: 18px;
                                    
                                  "
                                  value="<%= cartItemss.totalPrice !== 0 ? formatCurrency(cartItemss.totalPrice) : formatCurrency(0) %>"
                                >
    						<!-- <span style="color: blue; font-size: 18px;"><%= cartItemss.totalPrice !== 0 ? formatCurrency(cartItemss.totalPrice) : formatCurrency(0) %></span> -->
		    			</p>
		    					<p class="d-flex">
		    						<span style="color: black;">Vận Chuyển</span>
                    <input name="PhiShip"
                      type="text" 
                      readonly 
                      style="
                        border: none; /* Loại bỏ viền */
                        outline: none; /* Loại bỏ đường viền khi được focus */
                        background-color: transparent; /* Để hiển thị nền trong suốt */
                        color: blue;
                        font-size: 18px;
                        
                      "
                      value="<%= cartItemss.PhiShip !== 0 ? formatCurrency(cartItemss.PhiShip) : formatCurrency(0) %>"
                    >
		    						<!-- <span style="color: blue; font-size: 18px;"><%= cartItemss.PhiShip !== 0 ? formatCurrency(cartItemss.PhiShip) : formatCurrency(0) %></span> -->
		    					</p>
		    					<p class="d-flex">
		    						<span style="color: black;">Giảm Giá</span>
                    <input name="GiamGia"
                      type="text" 
                      readonly 
                      style="
                        border: none; /* Loại bỏ viền */
                        outline: none; /* Loại bỏ đường viền khi được focus */
                        background-color: transparent; /* Để hiển thị nền trong suốt */
                        color: blue;
                        font-size: 18px;
                        
                      "
                      value="<%= cartItemss.GiamGia !== 0 ? formatCurrency(cartItemss.GiamGia) : formatCurrency(0) %>"
                    >
		    						<!-- <span style="color: blue; font-size: 18px;">0</span> -->
		    					</p>
		    					<hr> 
		    					<p class="d-flex total-price">
		    						<span style="color: black;">TỔNG CỘNG</span>
                                   
                                    <input name="TongTien"
                                        type="text" 
                                        readonly 
                                        style="
                                            border: none; /* Loại bỏ viền */
                                            outline: none; /* Loại bỏ đường viền khi được focus */
                                            background-color: transparent; /* Để hiển thị nền trong suốt */
                                            color: red;
                                            font-size: 18px;
                                            font-weight: bold;
                                        "
                                        value="<%= cartItemss.totalPrice !== 0 ? formatCurrency(cartItemss.totalPrice + cartItemss.PhiShip) : formatCurrency(0) %>"
                                    >
		    						<!-- <span style="color: red; font-size: 18px;">
                                        <%= cartItemss.totalPrice !== 0 ? formatCurrency(cartItemss.totalPrice + cartItemss.PhiShip) : formatCurrency(0) %>
                                    </span> -->
                                    
		    					</p>
					</div>          
	          	</div>                               

	          	<div class="col-md-6">
	          		<div class="cart-detail p-3 p-md-4">
	          			<h3 class="billing-heading mb-4">Phương thức thanh toán</h3>
									<div class="form-group">
										<div class="col-md-12">
											<div class="radio">
											   <label><input type="radio" name="optradio" class="mr-2"> Chuyển khoản ngân hàng trực tiếp (update sau)</label>
											</div>
										</div>
									</div>
									<div class="form-group">
										<div class="col-md-12">
											<div class="radio">
											   <label><input required type="radio" name="optradio" class="mr-2"> Nhận hàng rồi thanh toán </label>
											</div>
										</div>
									</div>
									<div class="form-group">
										<div class="col-md-12">
											<div class="radio">
											   <label><input type="radio" name="optradio" class="mr-2"> Paypal (update sau)</label>
											</div>
										</div>
									</div>
									<div class="form-group">
										<div class="col-md-12">
											<div class="checkbox">
											   <label><input required type="checkbox" value="" class="mr-2"> Tôi đã đọc và chấp nhận các điều khoản và điều kiện</label>
											</div>
										</div>
									</div>
									<p><button style="font-size: 20px;" type="submit" class="btn btn-primary py-3 px-4">Tiến Hành Đặt Hàng</button></p>
								</div>
	          	</div>

              

            </form><!-- END -->
	          </div>
          </div> <!-- .col-md-8 -->
        </div>
    	</div>
    </section>
    <div id="custom-alert" class="custom-alert hidden">
      <p id="alert-message"></p>
    </div>
    <!-- END BODY --  CT CART -->


    <!-- START footer -->
    <%- include('../partials/footer.ejs') %>
    <!-- END footer -->
    

  <!-- loader -->
  <div id="ftco-loader" class="show fullscreen"><svg class="circular" width="48px" height="48px"><circle class="path-bg" cx="24" cy="24" r="22" fill="none" stroke-width="4" stroke="#eeeeee"/><circle class="path" cx="24" cy="24" r="22" fill="none" stroke-width="4" stroke-miterlimit="10" stroke="#F96D00"/></svg></div>


  <script src="js/jquery.min.js"></script>
  <script src="js/jquery-migrate-3.0.1.min.js"></script>
  <script src="js/popper.min.js"></script>
  <script src="js/bootstrap.min.js"></script>
  <script src="js/jquery.easing.1.3.js"></script>
  <script src="js/jquery.waypoints.min.js"></script>
  <script src="js/jquery.stellar.min.js"></script>
  <script src="js/owl.carousel.min.js"></script>
  <script src="js/jquery.magnific-popup.min.js"></script>
  <script src="js/jquery.animateNumber.min.js"></script>
  <script src="js/scrollax.min.js"></script>
  <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBVWaKrjvy3MaE7SQ74_uJiULgl1JY0H2s&sensor=false"></script>
  <script src="js/google-map.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-select/1.13.1/js/bootstrap-select.min.js"></script>
  <script src="js/main.js"></script>

  <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>

  <!-- xu ly loader page -->
  <script>
    document.addEventListener("DOMContentLoaded", function () {
      var form = document.getElementById("dathang");
      var loader = document.getElementById("loader");
  
      form.addEventListener("submit", function (event) {
        event.preventDefault();
  
        loader.style.display = "flex";
  
        setTimeout(function () {
          loader.style.display = "none";
          // Xử lý dữ liệu
        }, 3500);
      });
    });
  </script>

    <script>
        // format tiền tệ
        function formatCurrency(amount) {
            return new Intl.NumberFormat('vi-VN', { style: 'currency', currency: 'VND' }).format(amount);
        }

    </script>
    
    <!-- xử lý quốc gia và thành phố -->
    <script>
        // user country code for selected option
        var user_country_code = "IN";

        (() => {
            // script https://www.html-code-generator.com/html/drop-down/state-name

            // Get the country name and state name from the imported script.
            const country_array = country_and_states.country;
            const states_array = country_and_states.states;

            const id_state_option = document.getElementById("state");
            const id_country_option = document.getElementById("country");

            const createCountryNamesDropdown = () => {
                let option =  '';
                option += '<option value="" style="color: blue; font-weight: bold;">Chọn Quốc Gia</option>';

                for(let country_code in country_array){
                    // set selected option user country
                    let selected = (country_code == user_country_code) ? ' selected' : '';
                    option += '<option  style="color: black;" value="'+country_code+'"'+selected+'>'+country_array[country_code]+'</option>';
                }
                id_country_option.innerHTML = option;
            };

            const createStatesNamesDropdown = () => {
                let selected_country_code = id_country_option.value;
                // get state names
                let state_names = states_array[selected_country_code];

                // if invalid country code
                if(!state_names){
                    id_state_option.innerHTML = '<option  style="color: blue; font-weight: bold;">Chọn Thành Phố</option>';
                    return;
                }
                let option = '';
                option += '<select id="state">';
                option += '<option  style="color: blue; font-weight: bold;">Chọn Thành Phố</option>';
                for (let i = 0; i < state_names.length; i++) {
                    option += '<option  style="color: black;" value="'+state_names[i].name+'">'+state_names[i].name+'</option>';
                }
                option += '</select>';
                id_state_option.innerHTML = option;
            };

            // country select change event
            id_country_option.addEventListener('change', createStatesNamesDropdown);

            createCountryNamesDropdown();
            createStatesNamesDropdown();
        })();
    </script>
    
    <!-- thong bao dat hang thanh cong -->
    <script>
        // Hàm hiển thị thông báo tùy chỉnh
		  function showCustomAlert(message) {
        const alertElement = document.getElementById('custom-alert');
        const messageElement = document.getElementById('alert-message');

        // Hiển thị thông báo và đặt nội dung
        alertElement.style.display = 'block';
        messageElement.innerText = message;

        // Ẩn thông báo sau một khoảng thời gian (ví dụ: 5 giây)
        setTimeout(() => {
            hideCustomAlert();
            window.location.href = '/home';
          }, 2000);
      }

        // Hàm ẩn thông báo tùy chỉnh
        function hideCustomAlert() {
          const alertElement = document.getElementById('custom-alert');

          // Ẩn thông báo
          alertElement.style.display = 'none';
        }

        document.addEventListener('DOMContentLoaded', function () {
            const form = document.getElementById('dathang'); 

            form.addEventListener('submit', function (event) {
                event.preventDefault(); // Prevent the form from submitting in the traditional way

                // Assuming you are using FormData to serialize the form data
                const formData = new FormData(form);

                // Make an AJAX request
                fetch('/dat-hang', {
                    method: 'POST',
                    body: formData,
                })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        showCustomAlert(data.message);
                    } else {
                        console.error('Error in dat-hang:', data.message);
                    }
                })
                .catch(error => {
                    console.error('Error in dat-hang:', error);
                });
            });
        });


    </script>
  
  </body>
</html>